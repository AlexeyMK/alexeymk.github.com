<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Alexey needs a Web Presence</title>
	<meta name="author" content="">
	<link href='/css/style.css' rel="stylesheet" media="all">
	<link href="http://feeds.feedburner.com/AlexeyNeedsAWebPresence" rel="alternate" title="Alexey needs a Web Presence" type="application/atom+xml">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
  <script type="text/javascript">
    // google analytics

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-18901708-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    // Heap
    window.heap=window.heap||[];heap.load=function(a){window._heapid=a;var b=document.createElement("script");b.type="text/javascript",b.async=!0,b.src=("https:"===document.location.protocol?"https:":"http:")+"//cdn.heapanalytics.com/js/heap.js";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c);var d=function(a){return function(){heap.push([a].concat(Array.prototype.slice.call(arguments,0)))}},e=["identify","track"];for(var f=0;f<e.length;f++)heap[e[f]]=d(e[f])};
    heap.load("2484576110");
  </script>
</head>
<body>
<div id="page" class="hentry">
	<header class="the-header">
		<div class="unit-head">
			<div class="unit-inner unit-head-inner">
				<nav class="nav-global">
          <ul>
            <li class="logo"><a href="/">Alexey needs a web presence</a></li>
            <div id="stick-together">
              <li class="page"><a href="/about">about</a></li>
              <li class="page"><a href="http://feeds.feedburner.com/AlexeyNeedsAWebPresence">subscribe</a></li>
              <li class="page"><a href="http://twitter.com/alexeymk">twitter</a></li>
              <li class="page"><a href="mailto:alexey.at.alexeymk.com">contact</a></li>
            </div>
          </ul>
				</nav>
			</div><!-- unit-inner -->
		</div><!-- unit-head -->
	</header>
	<div class="body" role="main">
		<div class="unit-body">
			<div class="unit-inner unit-body-inner">
				<div class="entry-content">
					<div id="posts">
  <ol>
  
    
    <article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
            <h1 class="h2 entry-title"><a href="/flipping-coins-through-mechanical-turk-part-2/index.html">Flipping Coins through Mechanical Turk: Part 2</a></h1>
					</div><!-- unit-inner -->
            
              <p class="date-publish">
                Published:
                <date class="date-pub" title="2010-12-19T08:45:00-08:00" datetime="2010-12-19T08:45:00-08:00" pubdate>
                <span class="month"><abbr>December</abbr></span>
                <span class="day">19</span>
                <span class="year">2010</span>
                </date>
              </p>
            
				</div><!-- unit-head -->
			</header>

			<div class="bd">
				<div class="entry-content">
          <p><span style="color: #7e7e7e; font-size: medium;"><span style="font-size: 14px; line-height: 21px;"><em>Professor Jason Dana and I have been experimenting with Cheating and Turker Quality on Mechanical Turk. If you haven't yet, check out <a href="flipping-coins-through-mechanical-turk-part-1">Part 1</a>. Thanks for everybody's feedback so far - please keep it coming.</em></span></span></p>
<p><strong>Recap</strong></p>
<p>When we left off, we had just offered workers on Mechanical Turk the job of flipping a coin, paying them 4 cents for a flip of heads and 2 cents for tails. We wanted to measure whether and how much particular groups of Turkers, bucketed by their quality score, would cheat when given the chance to do so. &nbsp;</p>
<p>Though our <a href="alexeymk.com/flipping-coins-through-mechanical-turk-part-1#results">initial results</a> seemed to suggest a positive relationship between having a high quality score and not cheating, the amount of data collected was less than desired and did not have the numbers required for statistical significance.</p>
<p><strong>Experiment Two </strong></p>
<p>Realizing the difficulty of attracting top Turkers to a task that offered only two cents, we decided to up the ante and make two changes: first, we renamed the task to a more attractive "One quick question. Should take ~15 seconds." &nbsp;Second, we raised the price of heads and tails to 10c and 5c, respectively. &nbsp;Once again, we asked 50 Turkers in each of our quality groups to flip a coin, for a total of 300 coin-flips.</p>
<p><strong>Results</strong></p>
<p>Here's what we got. &nbsp;</p>
<p><img src="/images/5c-10c_chart.png" alt="Flipping Coins through Mechanical Turk: Part 2" /></p>
<p><em>Note: Error bars are at a 95% confidence interval.</em></p>
<p>This time around, all 300 HITs (tasks) we put out were done in a matter of days. The data, however, became less clear: sure, we expected the &lt;90% and 94-90% groups to cheat a ton (as they did), but what was the 100% group, the 'cream of the crop' doing by taking advantage of our trust and cheating as much as the lowest group, &lt;90%? &nbsp;</p>
<p><strong>Discussion</strong></p>
<p>This bothered us for a while. &nbsp;Who <strong>are </strong>these 100%-ers, after all? This is the group that can do no wrong, the group that makes less than 1 error in 100. How could they have betrayed our trust, especially after we offered them <strong>more </strong>money?&nbsp;</p>
<p>Melika&nbsp;Cavagnaro-Wong, a&nbsp;friend from Wharton, provided the key insight here: 100%-ers aren't necessarily the group that can do no wrong. They're just the group that never gets caught.</p>
<p><strong>Hypothesis</strong></p>
<p>I imagine a contingent of Turkers who have optimized their workflow to a tee. It's not easy to make a solid hourly wage from Turking, so one has to maximize productivity. Tasks below a certain financial payout or that take too long to do are not an option. HITs where quality can be ensured (identifying objects in images, transcribing audio) are only worthwhile if they pay well. HITs that can be easily gamed, however (multiple-choice surveys, coin-flips) are ripe for cheating - why not?<img src="/images/Mafia_lgo.jpg" alt="Flipping Coins through Mechanical Turk: Part 2" /></p>
<p>In an extreme state of the world, I imagine a cabal of Turkers somewhere, collaborating to maximize their effective hourly wage. Members would take turns looking at new tasks and figuring out (or even using software to measure) the expected hourly wage of a particular task. Other members in the group would then be sent links to the 'juiciest' tasks, and some sort of queue system would be used to manage what a particular cabal member's next task ought to be. &nbsp;<em>Note: we're looking into whether we can trace any evidence of something like this and will post about them at a later point.</em></p>
<p>Why, then did this hyper-efficient cabal not invade our 2c/4c experiment? Quite simply, the 2 cents advertised (the other 2c came as a bonus) initially likely flew well below their radar as a task not worth any time at all. Instead, the 19 people who did come to us from the 100% group are more likely to be the 'part-timers' - people who answered<span style="font-size: small; color: #000000;">&nbsp;<span style="font-family: Helvetica, Arial, Verdana, Trebuchet MS, sans-serif; line-height: 16px;"><a href="http://behind-the-enemy-lines.blogspot.com/2008/09/why-people-participate-on-mechanical.html">Panos Ipeirotis'&nbsp;</a></span><a href="http://behind-the-enemy-lines.blogspot.com/2008/09/why-people-participate-on-mechanical.html">'W</a></span><a href="http://behind-the-enemy-lines.blogspot.com/2008/09/why-people-participate-on-mechanical.html">hy do you Turk' survey</a> with either "it's fun" or "it's rewarding." &nbsp;This group is not financially motivated and less likely to cheat.</p>
<p>These altruistic Turkers are a minority, however; once money comes into play, they get <a href="http://www.australianreview.net/digest/2007/06/waldby.html">Crowded In</a>&nbsp;by the 100% optimizers. &nbsp;</p>
<p><strong>Crowding In</strong></p>
<p><strong>&nbsp;</strong>In behavioral economics, crowding in is the idea that paying too much for a task may get the wrong kind of people to do it. A classic example of crowding in is <a href="http://en.wikipedia.org/wiki/Blood_donation#Benefits_and_incentives">paying for blood donations</a>, outlawed in the US and most of the rest of the world for several decades now. The problem, as <a href="http://en.wikipedia.org/wiki/Richard_Titmuss">Richard Titmuss</a> described in&nbsp;<span style="font-family: sans-serif; line-height: 19px;"><em><a href="http://www.amazon.com/Gift-Relationship-Human-Social-Policy/dp/1565844033">The Gift Relationship: From Human Blood to Social Policy</a>, </em>is that offering cash for blood gets the exact wrong kind of blood donor: the type that could really go for some cash <em>right now </em>and therefore may not have the cleanest blood available. &nbsp;</span></p>
<p><span style="font-family: sans-serif; line-height: 19px;">Similarly, as we offer increasingly larger enticements to participate in the coin flip experiment, we seem to be crowding the 'doing this for fun' crowd out in favor of the 'optimizer' crowd. The effect should be particularly evident in the 100% group, where both a lot of altruists and a lot of optimizers are likely to end up, altruists because they do good work and optimizers because it pays to be qualified for restrictive tasks.</span></p>
<p><strong>Experiment</strong></p>
<p>Luckily, this turned out to be a reasonably simple thing to test. Taking the 100%-ers as our experiment and 95-97% as our control group, we offered the same coin-flip experiment to 50 participants in each group and altering the payment for tails/heads to, one after the other, 10c/15c and 3c/8c. We kept the bonus at 5 cents and altering only the original offer, since the base payment is the only number Turkers can see before accepting the HIT.</p>
<p><strong>Results</strong></p>
<p><span style="font-style: italic;"><img src="/images/percent-heads-by-reward.png" alt="Flipping Coins through Mechanical Turk: Part 2" />Note: Error bars are at a 95% confidence interval.</span></p>
<p><span style="font-style: italic;">&nbsp;</span>From our experiment, it looks like while offering more money leads to <strong>more cheating</strong>&nbsp;for the 100% group, cheating actually goes <strong>down </strong>for the 95-97% control group.&nbsp;This fits with our hypothesis: in the 95-97% group, adding more money disincentives cheating -&nbsp;5 cents for cheating looks less enticing if I've already received 10 cents and more enticing if I've only received 3.&nbsp;Dishonesty can be bought, but only at a reasonable multiplier to the base reward. &nbsp;</p>
<p>In the 100% group, however, the opposite occurs: the more money is offered, the more interesting the task becomes to optimizers, and optimizers cheat whenever they can get away with it. &nbsp;</p>
<p>The results are not&nbsp;<em>quite&nbsp;</em>statistically significant, as the error bars illustrate, but they tell a reasonably compelling story nonetheless.&nbsp;</p>
<p>Do you agree with our hypothesis? &nbsp;What other, alternate explanations might exist for these results?</p>
<p><strong>Next Steps</strong></p>
<p>We collected additional data about the Turkers as we conducted our experiment. Here's some of the analysis I intend for Part 3:</p>
<ul>
<li><strong>Cheating by Time Taken: </strong>Can we predict whether a Turker really flipped a coin or not by looking at how long the assignment took them?</li>
<li><strong>Cabal Trends: </strong>Can we identify any collusion amongst Turkers? &nbsp;Assuming Turkers share tasks, are there any patterns of heads-heads-heads-heads... in our data within a fairly short time span?</li>
<li><strong>National Trends: </strong>Most Turkers (&gt;90%, in our case)&nbsp;are either in the US or in India. Do Americans or Indians cheat more? Is either group more likely to be 100%-ers? Are Americans less likely to accept low-paying tasks? We started tracking IPs only by the time we ran the 3c/8c and 10c/15c groups, but even that subset of data points remain interesting.</li>
</ul>
<p>Any ideas for other interesting analysis I should run?</p>

          
            <div class="meta">
              <ul class="list-tag list-linear">
                <li class="list-head">tags: </li>
                
                
                <li><a href="/tag/ mturk/"> mturk</a>,</li>
                
                <li><a href="/tag/behavioral econ/">behavioral econ</a>,</li>
                
                <li><a href="/tag/research/">research</a></li>
                
              </ul>
            </div><!-- meta -->
          </div><!-- entry-content -->
          <div class="misc-content">
            <div class="social">
              <ul class="list-linear">
                <li><div class="twitter-tweet"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-url="http://alexeymk.com/flipping-coins-through-mechanical-turk-part-2/index.html" data-via="" data-lang="en">Tweet</a></div></li>
                <li><div class="twitter-follow"><a href="https://twitter.com/" class="twitter-follow-button" data-show-count="false" data-lang="en"></a></div></li>
              </ul>
            </div>
            <div class="comment">
            </div>
          </div><!-- misc-content -->
        
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							
							
						</ul>
					</nav>
					<p class="gotop">
						<a href="#page">Back to Top</a>
					</p>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>

  
    
    <article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
            <h1 class="h2 entry-title"><a href="/flipping-coins-through-mechanical-turk-part-1/index.html">Flipping Coins through Mechanical Turk: Part 1</a></h1>
					</div><!-- unit-inner -->
            
              <p class="date-publish">
                Published:
                <date class="date-pub" title="2010-12-18T10:42:00-08:00" datetime="2010-12-18T10:42:00-08:00" pubdate>
                <span class="month"><abbr>December</abbr></span>
                <span class="day">18</span>
                <span class="year">2010</span>
                </date>
              </p>
            
				</div><!-- unit-head -->
			</header>

			<div class="bd">
				<div class="entry-content">
          <p><em>Over the past semester, I participated in an Independent Study in Behavioral Economics with Professor Jason Dana.&nbsp; Here's what we've been up to</em>:</p>
<p><strong>Mechanical Tur</strong><strong>k </strong>is Amazon's 'artificial artificial intelligence' service.<img src="/images/250px-Kempelen_chess1.jpg" alt="Flipping Coins through Mechanical Turk: Part 1" /> Named after a <a href="http://en.wikipedia.org/wiki/The_Turk">fake chess-playing machine</a> in the late 17th-18th century, According to Amazon, MTurk is a</p>
<blockquote>
<p><span style="font-size: small;">marketplace for work that requires human intelligence. The Mechanical Turk web service enables companies to programmatically access this marketplace and a diverse, on-demand workforce. Developers can leverage this service to build human intelligence directly into their appli</span><em></em><span style="font-size: small;">cations</span></p>
</blockquote>
<p>As <a href="http://www.codinghorror.com/blog/2007/04/is-amazons-mechanical-turk-a-failure.html">Jeff Atwood explains</a>,</p>
<blockquote>
<p><span style="font-size: small;">It's a service that attempts to match people to small, bite-size units of work that are unsuitable for machines.</span></p>
</blockquote>
<p>For example: You have a list of thousands websites and want to know which ones are appear to be well-designed. Algorithms to quantify taste do not yet (sadly) exist; instead, either look through the websites yourself, or offer the task to Mechanical Turk. Turkers, as the workers are called, are then paid 5 cents (or however much you offer) to rate each website. Hundreds of people can work on your classification task in parralel, saving time and money.<em></em></p>
<p>Common uses of Mechanical Turk include transcribing audio, identifying photos, or answering opinion surveys.</p>
<p><strong>The Cheating Problem</strong></p>
<p>Without oversight, what prevents Turkers from voting randomly? For objective tasks, you could manually go over each result yourself, but this would be exteremely time-intensive and defeat the purpose. For subjective tasks, even that wouldn't be possible - who knows if the Turker's choice of 3/10 for some website was<em></em> his actual opinion or a random choice?</p>
<p>There are a couple of approaches that work here. You could try to get multiple Turkers to do each task and make sure they agree on the answers.&nbsp; You could do part of the work yourself, (set a <strong>gold standard</strong>) and verify Turker quality by how well they do on the tasks to which you now know the right answers. Finally, you can restrict your Turker employee base to a highly-qualified one, limiting your employee pool to those who have done good work before.&nbsp; As a side note, companies like <a href="http://crowdflower.com/">CrowdFlower</a> try to restrict and manage for high-quality workers on your behalf; if you're willing to pay more for your automated tasks, I've heard good things about them.</p>
<p>Amazon measures this 'done good work before' metric by looking at the Turker's <strong>HIT Approval Rate - </strong>the % of tasks that this worker has done in the past that were subsequently accepted by the employer. Limiting your workers to 95%+ is a standard way of trying to obtain only high-quality responses.</p>
<p><strong>The Research Question</strong></p>
<p>The question, then, is whether limiting the Turkers to those with a high acceptance rate is an effective way of making sure they don't cheat.&nbsp; We were also wondering where the cutoff for cheaters was and whether the amount of money offered for the task would affect the amount of cheating.<em></em></p>
<p><strong>The Setup<br /></strong></p>
<p>Our experiment is as simple as possible:<em><span style="font-style: normal;"><em></em></span><img src="/images/flipacoin.png" alt="Flipping Coins through Mechanical Turk: Part 1" /></em><em></em></p>
<p>The idea is based on an experiment Prof. Dana has run at Solomon Behavioral Labs at Penn as well as abroad [that we should probably link to/cite here].&nbsp; We can't tell if any particular individual is cheating - perhaps they happened to flip heads - but in the aggregate, if we ask 50 homogenous Turkers to flip a coin and see how many heads we get, 50 heads indicates that the Turkers are a dishonest bunch, while 25 heads and 25 tails would indicate a fair and friendly group of turkers.</p>
<p>We offered the same task to 50 turkers in one of several groups, varying by <strong>HIT Approval Rate. </strong><span style="font-family: mceinline;">An informal survey (IE, we asked one of Prof. Dana's grad students)</span> suggested that cutoffs of &lt;89%, 90-94%, 95-97%, 98-99% and 100% would be reasonable. We also offered the task to a group of Turk newbies (filtered by the fact that they had less than 20 tasks completed under their belt).</p>
<p>Offering 2c for tails and 4c for heads, we hoped to see how rampant cheating for subjective tasks was amongst various groups of accom<em></em>plishment.&nbsp;</p>
<p><strong><a name="results">The Results</a></strong><em><img src="/images/results_2c4c.PNG" alt="Flipping Coins through Mechanical Turk: Part 1" /></em>The data did not dissapoint. Excluding the 95-97% anomaly, the trend was clear: the better your Turkers, the more honest (by and large) they would be when offered subjective tasks where they could cheat without being detected.</p>
<p>Since this was our first attempt at Mechanical Turk, though, we did not do as good of a job with the price offered or the marketing of the task (we named it 'Project Random'). As a result, we got only 158 participants (out of a possible 300), and only 19 100%-ers.&nbsp; Clearly, the price offered would have to go up.&nbsp;</p>
<p>How do you think offering more money affected the cheating chart? Should cheating go up or down, as a whole, if we offer 5c/10c instead of 2c/4c? Should any groups be more or less affected than average by an increased incentive to cheat?</p>
<p><em>Update: Part 2 is available <a href="flipping-coins-through-mechanical-turk-part-2">here</a>.</em></p>

          
            <div class="meta">
              <ul class="list-tag list-linear">
                <li class="list-head">tags: </li>
                
                
                <li><a href="/tag/ mturk/"> mturk</a>,</li>
                
                <li><a href="/tag/behavioral econ/">behavioral econ</a>,</li>
                
                <li><a href="/tag/research/">research</a></li>
                
              </ul>
            </div><!-- meta -->
          </div><!-- entry-content -->
          <div class="misc-content">
            <div class="social">
              <ul class="list-linear">
                <li><div class="twitter-tweet"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-url="http://alexeymk.com/flipping-coins-through-mechanical-turk-part-1/index.html" data-via="" data-lang="en">Tweet</a></div></li>
                <li><div class="twitter-follow"><a href="https://twitter.com/" class="twitter-follow-button" data-show-count="false" data-lang="en"></a></div></li>
              </ul>
            </div>
            <div class="comment">
            </div>
          </div><!-- misc-content -->
        
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							
							
						</ul>
					</nav>
					<p class="gotop">
						<a href="#page">Back to Top</a>
					</p>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>

  
    
    <article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
            <h1 class="h2 entry-title"><a href="/xsanyuri-doesnt-allow-ampersands/index.html">xs:anyURI requires ampersands to be escaped</a></h1>
					</div><!-- unit-inner -->
            
              <p class="date-publish">
                Published:
                <date class="date-pub" title="2010-11-28T14:42:00-08:00" datetime="2010-11-28T14:42:00-08:00" pubdate>
                <span class="month"><abbr>November</abbr></span>
                <span class="day">28</span>
                <span class="year">2010</span>
                </date>
              </p>
            
				</div><!-- unit-head -->
			</header>

			<div class="bd">
				<div class="entry-content">
          <p>Quick heads-up, in case anybody else runs into this problem.</p>
<p><strong><span style="font-size: medium;">Background</span>:</strong></p>
<p>I've been working with passing an ExternalQuestion to MechanicalTurk, and have learned (the hard way) that the 'ExternalURL' component, set up as a "xs:anyURI" in the MTurk AWS schema, does not allow ampersands '&amp;' except if escaped via '&amp;amp;'.&nbsp;</p>
<p>That was not at all obvious. The AWS exception gives is:</p>
<div class="CodeRay">
  <div class="code"><pre>&lt;CreateHITResponse&gt;
  &lt;OperationRequest&gt;
    &lt;RequestId&gt;...&lt;/RequestId&gt;
  &lt;/OperationRequest&gt;
  &lt;HIT&gt;
    &lt;Request&gt;
      &lt;IsValid&gt;False&lt;/IsValid&gt;
      &lt;Errors&gt;
        &lt;Error&gt;
          &lt;Code&gt;AWS.MechanicalTurk.XMLParseError&lt;/Code&gt;
          &lt;Message&gt;There was an error parsing the XML question or answer data in your request.  Please make sure the data is well-formed and validates against the appropriate schema. (1291006584155 s)&lt;/Message&gt;
        &lt;/Error&gt;
      &lt;/Errors&gt;
    &lt;/Request&gt;
  &lt;/HIT&gt;/
&lt;/CreateHITResponse&gt;</pre></div>
</div>

<p><span style="font-size: medium;"><strong>Solution:&nbsp;</strong></span></p>
<p><span style="font-size: small;">Replace any instance of &amp; in the ExternalQuestion URI (IE, <a href="http://www.yoursite.com/mturk/a.php?foo=true&amp;bar=false">www.yoursite.com/mturk/a.php?foo=true&amp;bar=false</a>) with &amp;amp;&nbsp;(IE, <a href="http://www.yoursite.com/mturk/a.php?foo=true&amp;amp;bar=false">www.yoursite.com/mturk/a.php?foo=true&amp;amp;bar=false</a>).</span></p>
<p>That'll fix it.</p>
<p><span style="font-size: medium;"><strong>Reference</strong></span>:&nbsp;</p>
<p><a href="http://developer.ebay.com/devzone/xml/docs/reference/ebay/types/simpleTypes.html">ebay developer docs</a>&nbsp;(strangely enough),&nbsp;<a href="http://docs.amazonwebservices.com/AWSMechanicalTurkRequester/2008-02-14/ApiReference_ExternalQuestionArticle.html">External Question documentation</a>.</p>
<p>&nbsp;</p>

          
            <div class="meta">
              <ul class="list-tag list-linear">
                <li class="list-head">tags: </li>
                
                
                <li><a href="/tag/mturk/">mturk</a>,</li>
                
                <li><a href="/tag/technical/">technical</a></li>
                
              </ul>
            </div><!-- meta -->
          </div><!-- entry-content -->
          <div class="misc-content">
            <div class="social">
              <ul class="list-linear">
                <li><div class="twitter-tweet"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-url="http://alexeymk.com/xsanyuri-doesnt-allow-ampersands/index.html" data-via="" data-lang="en">Tweet</a></div></li>
                <li><div class="twitter-follow"><a href="https://twitter.com/" class="twitter-follow-button" data-show-count="false" data-lang="en"></a></div></li>
              </ul>
            </div>
            <div class="comment">
            </div>
          </div><!-- misc-content -->
        
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							
							
						</ul>
					</nav>
					<p class="gotop">
						<a href="#page">Back to Top</a>
					</p>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>

  
    
    <article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
            <h1 class="h2 entry-title"><a href="/h-file-generator/index.html">.h file generator</a></h1>
					</div><!-- unit-inner -->
            
              <p class="date-publish">
                Published:
                <date class="date-pub" title="2010-11-02T04:33:00-07:00" datetime="2010-11-02T04:33:00-07:00" pubdate>
                <span class="month"><abbr>November</abbr></span>
                <span class="day">02</span>
                <span class="year">2010</span>
                </date>
              </p>
            
				</div><!-- unit-head -->
			</header>

			<div class="bd">
				<div class="entry-content">
          <p><strong>TL; DR</strong>: want to auto-generate .h files from .c files? Type <a href="#sol">this</a> into vim.</p>
<p><strong>C sucks.</strong> <em>[Disclaimer: OK, I don't like C; I'm a python/functional languages guy. You may love it. Whatever.]</em></p>
<p>There's lots of little annoying things about C; memory management, using #ifdefs for header file declarations, manually written header files, etc. The good news is, I've half-solved the last issue. &nbsp;</p>
<p>Say you have a simple main file, as follows</p>
<div class="CodeRay">
  <div class="code"><pre>int main(int argc, char ** argv) {
  char* str = malloc(sizeof(char*) * 3);
  str[0] = getFirstChar();
  str[1] = 'F';
  str[2] = '\0';
  printf(&quot;%s&quot;, str);
  free(str);
  return 0;
}

char getFirstChar() {
  return 'A';
}</pre></div>
</div>

<p>Dead-simple. Unfortunately, you get the following issue when trying to compile:</p>
<div class="CodeRay">
  <div class="code"><pre>main.c:11: error: conflicting types for ‘getFirstChar’
main.c:3: note: previous implicit declaration of ‘getFirstChar’ was here</pre></div>
</div>

<p>Here's why this happens: the C compiler parses your c file once. The first time it sees getFirstChar, it realizes that it hasn't seen a method declaration for it yet, so it creates an implicit one. Unfortunately, an implicit declaration, or stub, will always assume a return type of int, while the actual type is a char. So, type mismatch.</p>
<p>There are a couple of ways to solve this problem:</p>
<ol>
<li><strong>Put getFirstChar above of main.</strong> This <em>kind of</em> works, but now you've got to order your functions based on some partial order you can't control. If you've got an instance of two functions calling one another in some proto-co-recursive way, this won't work at all.  In general, less flexibility than you'd like.</li>
<li><strong>Declare the method headers at the top of the file/create a header file</strong>
<div class="CodeRay">
  <div class="code"><pre>int main(int argc, char** argv);
char getFirstChar(); 
...
#include &quot;main.h&quot;</pre></div>
</div>

This it the 'proper' way to solve the problem, but now you've got a header file you've got to keep current. If you're the kind of person to plan all of your code out before you write it, you're paying a one-time cost to create a header file. If you're making updates, however, or if you're like me and you figure out what methods you should have as you go along, this means you're updating the header files every time you edit a method name, just to freaking compile, all to solve a problem other languages <strong>don't even have.</strong></li>
</ol>
<h3><a name="sol">The solution</a></h3>
<p>In its most basic iteration, a header file is just your method declarations w/ semicolons instead of open braces. It shouldn't be that hard to just auto-generate the header file whenever you make a difference, or whenever you compile. So that's what I started doing. I'm a vim guy. With a bit of research and poking around, here's a quick command you can run in vim to generate a simple .h file from a given .c file:</p>
<div class="CodeRay">
  <div class="code"><pre>:%s/^\(\w.*{\t*$\)\@!.*\n//
then:
:%s/ {/;</pre></div>
</div>

<p><em>[Disclaimer: Do not use this in its exact form for a serious project. Header files are a bit more complicated than the version we're dealing with.&nbsp; The current proposal is best suited for homework assignments or quick one-off projects]</em></p>
<p><strong>What this does:</strong> The commands above remove all lines that don't look like a method declaration, then swaps open braces for semicolons. Note that it assumes that you don't indent your method declarations and that you inline the opening brace of function declarations. To use the commands, just copy the .c file to a .h, open the .h and run those commands.</p>
<h3>Next Steps</h3>
<p>I don't have to write any more C for another week or so, but I think the following steps make sense for taking .h file generation to the next level:</p>
<ol>
<li><strong>Rewrite as shell or python script.</strong>&nbsp; Switching from vim commands to python is probably going to add some flexibility.</li>
<li><strong>Incorporate the script directly into a Makefile.&nbsp; </strong>In this scenario, make will depend on header files being re-generated, and only then call GCC.</li>
<li><strong>Include some of the other stuff .h files typically include</strong> This current approach makes the assumption that all relevant comments, #includes, structs and typedefs in your program belong in the .c file exclusively. Typically, at least some of those belongs in .h instead. A future version would potentially modify ensure that previous .h files are not overridden but instead amended.&nbsp; </li>
</ol>
<p>Hopefully the commands will come in handy to others as spoiled by HLL as me, who can't believe that C doesn't already to these things for you.</p>
<p>Thoughts/feedback?</p>

          
            <div class="meta">
              <ul class="list-tag list-linear">
                <li class="list-head">tags: </li>
                
                
                <li><a href="/tag/technical/">technical</a></li>
                
              </ul>
            </div><!-- meta -->
          </div><!-- entry-content -->
          <div class="misc-content">
            <div class="social">
              <ul class="list-linear">
                <li><div class="twitter-tweet"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-url="http://alexeymk.com/h-file-generator/index.html" data-via="" data-lang="en">Tweet</a></div></li>
                <li><div class="twitter-follow"><a href="https://twitter.com/" class="twitter-follow-button" data-show-count="false" data-lang="en"></a></div></li>
              </ul>
            </div>
            <div class="comment">
            </div>
          </div><!-- misc-content -->
        
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							
							
						</ul>
					</nav>
					<p class="gotop">
						<a href="#page">Back to Top</a>
					</p>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>

  
    
    <article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
            <h1 class="h2 entry-title"><a href="/first-also-a-placeholder/index.html">First! (also, a placeholder)</a></h1>
					</div><!-- unit-inner -->
            
              <p class="date-publish">
                Published:
                <date class="date-pub" title="2010-10-03T13:51:00-07:00" datetime="2010-10-03T13:51:00-07:00" pubdate>
                <span class="month"><abbr>October</abbr></span>
                <span class="day">03</span>
                <span class="year">2010</span>
                </date>
              </p>
            
				</div><!-- unit-head -->
			</header>

			<div class="bd">
				<div class="entry-content">
          <p>This is going to be the personal/professional blog of Alexey Komissarouk (that'd be me), where I'm going to write about my particular interests: the hazy intersection between Web 2.0y-things, Data Mining, the Social Graph, Behavioral Econ, Product and UX Design, Data Visualization, Tech@Penn, and really any other buzzwords that will feel appropriate. I'm planning to do a reasonbly-sized post at least weekly, and potentially throw in some shorter stuff here and there.</p>
<p>The point is, sometimes I have these thoughts that aren't completely idiotic. It's about damn time I aggregate and centralize them, to feed the google, etc.</p>
<p>I leave you with<a href="http://pennapps2010.posterous.com/keep-it-simple-keep-it-relevant"> an interview I did with Soleio</a> (a Designer with Facebook and overall awesome guy) for<a href="http://pennapps.com"> PennApps 2010</a>.</p>

          
            <div class="meta">
              <ul class="list-tag list-linear">
                <li class="list-head">tags: </li>
                
                
              </ul>
            </div><!-- meta -->
          </div><!-- entry-content -->
          <div class="misc-content">
            <div class="social">
              <ul class="list-linear">
                <li><div class="twitter-tweet"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-url="http://alexeymk.com/first-also-a-placeholder/index.html" data-via="" data-lang="en">Tweet</a></div></li>
                <li><div class="twitter-follow"><a href="https://twitter.com/" class="twitter-follow-button" data-show-count="false" data-lang="en"></a></div></li>
              </ul>
            </div>
            <div class="comment">
            </div>
          </div><!-- misc-content -->
        
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							
							
						</ul>
					</nav>
					<p class="gotop">
						<a href="#page">Back to Top</a>
					</p>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>

  
  </ol>
</div>
<!-- Pagination links -->
<div class="pagination">
  <span class="page_number ">Page: 14 of 14</span>
  
</div>



				</div>
			</div><!-- unit-inner -->
		</div><!-- unit-body -->
	</div><!-- body -->
	<footer class="the-footer">
		<div class="unit-foot">
			<div class="unit-inner unit-foot-inner">
				<div class="misc vcard">
          
          <h4 id="about">about</h4>
<p><img class="footer-portrait" src="/images/alexey.jpg" /></p>

<h5 id="current">Current</h5>
<p>Staff Growth Eng @ MasterClass</p>

<h5 id="past">Past</h5>
<ul>
  <li>Engineering at <a href="https://opendoor.com">Opendoor</a>, 2016-2020</li>
  <li><a href="http://hackerparadise.org">Hacker Paradise</a>, the remote-work-group-trip thing.</li>
  <li>UPenn <a href="http://www.cis.upenn.edu/">CIS ‘12</a></li>
  <li>Projects you may know me for:
    <ul>
      <li><a href="http://atmosphere.meteor.com/package/houston">Houston</a>, the Meteor Admin.</li>
      <li><a href="http://baydin.com/blog/2013/07/new-to-boomerang-calendar-schedule-meetings-in-a-single-email/">Boomerang Calendar</a></li>
      <li><a href="http://pennapps.com">PennApps</a>, the student hackathon</li>
    </ul>
  </li>
</ul>

<p>More at <a href="/about">about.alexeymk.com</a></p>

      </div><!-- misc -->
        <br />
				<p class="license">
					Theme: <a href="http://layouts-the.me">the_minimum</a> based on <a href="http://jekyllbootstrap.com/">Jekyll-bootstrap</a>.<br>
					Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a>.
				</p>
			</div><!-- unit-foot-inner -->
		</div><!-- unit-foot -->
	</footer>
</div><!-- page -->
<script>
	(function(d, s) {
		var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
		if (d.getElementById(id)) {return;}
		js = d.createElement(s); js.src = url; js.id = id;
		fjs.parentNode.insertBefore(js, fjs);
		};
	load('//platform.twitter.com/widgets.js', 'tweetjs');
	}(document, 'script'));
</script>
<script>
/*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
(function(j){var i=j.document;if(!i.querySelectorAll){return}var l=i.querySelectorAll("meta[name=viewport]")[0],a=l&&l.getAttribute("content"),h=a+", maximum-scale=1.0",d=a+", maximum-scale=10.0",g=true,c=j.orientation,k=0;if(!l){return}function f(){l.setAttribute("content",d);g=true}function b(){l.setAttribute("content",h);g=false}function e(m){c=Math.abs(j.orientation);k=Math.abs(m.gamma);if(k>8&&c===0){if(g){b()}}else{if(!g){f()}}}j.addEventListener("orientationchange",f,false);j.addEventListener("deviceorientation",e,false)})(this);
</script>

</body>
</html>
